# AGENTS.md

## Назначение
Инструкции для ИИ‑агента, который работает с бэклогом через локальный `tfs` CLI. Схема работы соответствует интеграционным тестам: создать ПБИ и создать дочерние задачи.
Дополнительную информацию по командам можно получить через `--help`.

## Важно
- **Весь контент бэклога — только на русском** (заголовки, описания, комментарии, теги).
- Используйте **имя типа** (value[].name), а не referenceName, в параметре `--type`.
- Используйте бинарь `./tfs` из корня репозитория (а не `tfs` из PATH).
- Не задавайте теги при создании элементов (не используйте `System.Tags`).
- В заголовке **не добавляйте префикс типа** (без "ПБИ:" / "Задача:") — указывайте только само название.
- `assigned-to` берется из PAT‑токена по умолчанию, не запрашивайте его у пользователя и не передавайте явно.
- У всех новых элементов **обязательно** указывать путь текущей итерации через `System.IterationPath`.
- При запросе на декомпозицию **обязательно** сначала смотрите контент элемента через `tfs show <ID>`.

## Создать ПБИ (Элемент невыполненной работы по продукту)
```
tfs create \
  --type "Элемент невыполненной работы по продукту" \
  --title "<краткий заголовок>" \
  --set "System.Description=<краткое описание>"
```

## Создать задачу как дочернюю по отношению к ПБИ
```
tfs create \
  --type "Задача" \
  --title "<краткий заголовок>" \
  --parent <ID_ПБИ> \
  --set "System.Description=<описание задачи>"
```
### Оформление описания задач
Описание задачи должно быть оформлено по шаблону:
```
<краткое описание одним предложением>

Результат: <ожидаемый результат>
```
Важно: в `System.Description` **не используйте `\n\n`** — это не работает. Передавайте реальные переводы строк.
Пример (bash):
```
--set $'System.Description=Краткое описание одним предложением\n\nРезультат: Ожидаемый результат'
```

### Обязательные поля для задач: Активность / Оценки
Эти поля **нужно задавать по referenceName**. Частые значения:
- Активность (обязательно, значение строго "Разработка"): `Microsoft.VSTS.Common.Activity`
- Оставшаяся работа (обязательно): `Microsoft.VSTS.Scheduling.RemainingWork`
- Исходная оценка (обязательно): `Microsoft.VSTS.Scheduling.OriginalEstimate`

Если в вашем процессе другие referenceName, уточните у пользователя.
Пример:
```
tfs create \
  --type "Задача" \
  --title "<краткий заголовок>" \
  --parent <ID_ПБИ> \
  --set $'System.Description=<описание задачи>\n\nРезультат: <ожидаемый результат>' \
  --set "Microsoft.VSTS.Common.Activity=Разработка" \
  --set "Microsoft.VSTS.Scheduling.RemainingWork=4" \
  --set "Microsoft.VSTS.Scheduling.OriginalEstimate=4"
```

## Добавить комментарий
```
tfs update <ID> --add-comment "<комментарий на русском>"
```

## Посмотреть подробности и дочерние элементы
```
tfs show <ID>
```
Показывает: заголовок, описание, назначение, теги, последний комментарий и краткий список дочерних элементов.

## Список моих элементов
```
tfs my
```

## Подводные камни и защита от дубликатов
- Сетевые ошибки/таймауты **не означают**, что элемент не создан: запись могла появиться, а ответ не дошёл.
- После **любого** неуспеха/таймаута `tfs create` сначала проверьте, не создан ли элемент:
  - `./tfs my` и найдите по заголовку.
  - `./tfs show <ID>` чтобы убедиться в описании, типе и родителе.
- Не повторяйте `create`, пока не убедились, что элемента нет — иначе легко получить дубликаты.
- При пакетном создании задач создавайте их **по одной**; если скрипт оборвался, проверьте список и продолжайте со следующей.
- Всегда фиксируйте возвращённый ID из ответа `tfs create`; если парсинг вывода не удался, считайте операцию подозрительной и проверьте вручную через `./tfs my`.

## Безопасность
- Не выполняйте разрушительных операций.
- Для массовых изменений (>5 полей) `tfs update` требует `--yes`.
